function cargarMapa(){$.ajax({url:"coordenadas.geojson",dataType:'json',async:false,type:'post',success:function(datos){function popup_(feature,layer){if(feature.name){var info=feature.name;layer.bindPopup(info);}else if(feature){layer.bindPopup(feature);}}var layerPoligonos=L.geoJson(datos,{style:stylePolygon,onEachFeature:popup_}).addTo(mapa);$.getJSON("server/consultaResintos.php",function(p_data_eventos){var resintos=L.geoJson(p_data_eventos,{pointToLayer:function(feature,latlng){lamMarker=L.marker(latlng,{zona:feature.properties.zona,resinto:feature.properties.resinto});return(lamMarker);},onEachFeature:function(feature,layers){markerK.push(lamMarker);key=feature.properties.id;markerK[key]=on('click',onClick());mapa.addLayer(markerK[key]);}}).addTo(mapa);function getColor(d){return d>79.9?'#1F90FF':d>59.9?'#1CE867':d>39.9?'#FBFF2C':d>19.9?'#E8941C':'#FF2B31';}function style(feature){return{fillColor:getColor(feature.properties.porcentaje),weight:1,opacity:1,color:'white',dashArray:'2',fillOpacity:0.8};}var legend=L.control({position:'bottomright'});legend.onAdd=function(map){var div=L.DomUtil.create('div','info legend'),grades=[00,20,40,60,80],labels=['ROJO','NARANJA','AMARILLO','VERDE','AZUL'];for(var i=0;i<grades.length;i++){div.innerHTML+='<i style="background:'+getColor(grades[i]+1)+'"></i> '+grades[i]+(grades[i+1]?'&ndash;'+grades[i+1]+'<br>':'+');}return div;};legend.addTo(mapa);var baseMaps={"OSM":osmBase,"Mapnik":mapnik_layer,"Humanitarian":humanitarian_layer,"google":google};overlayMaps={"Pol√≠gono":layerPoligonos,"Resintos":resintos};L.control.layers(baseMaps,overlayMaps,{position:'topright',collapsed:true}).addTo(mapa);});},error:function(msgj){console.log("Error!!!");}});mapa.addControl(new L.Control.Search({url:'https://nominatim.openstreetmap.org/search?format=json&q={s}',jsonpParam:'json_callback',propertyName:'display_name',propertyLoc:['lat','lon'],marker:L.circleMarker([0,0],{radius:30}),autoCollapse:true,autoType:false,minLength:2}));var style={radius:5,fillColor:"yellow",color:"#000",weight:1,opacity:1,fillOpacity:0.7};}
